\chapter{METODOLOGIA \label{metodologia}}

\hspace*{1.25cm}Neste Capítulo, serão definidas as metodologias a serem utilizada
para a realização da detecção de transições.

\begin{figure}[h|top]
    \centering
    \includegraphics[width=1.0\linewidth]{imagens/metodologia.png}
    \caption{Diagrama esquemático da metodologia proposta.}
    \label{img_metodologia} Fonte: Autor.
\end{figure}

\hspace*{0.65cm}A Figura \ref{img_metodologia} mostra um esquema
geral da metodologia proposta neste trabalho, que consiste em: a
partir de um dado vídeo de entrada o sistema realizará a detecção de
suas transições (corte/fade/dissolve), sendo que para cada tipo de
transição, será aplicada uma metodologia diferente, as quais serão
detalhadas posteriormente. Após estes processos o vídeo poderá ser
editado, com aplicação de efeitos visuais.

\section{Cortes \label{met_cortes}}

\begin{figure}[h|top]
    \centering
    \includegraphics[width=1.0\linewidth]{imagens/metodologia_cortes.png}
    \caption{Metodologia utilizada para a detecção de Cortes.}
         \label{img_metcortes} Fonte: Autor.
\end{figure}

\hspace*{1.25cm}A Figura \ref{img_metcortes} representa a metodologia utilizada para
a detecção de transições do tipo Corte:

\begin{enumerate}

    \item{\textbf{Vídeo:} É feita a entrada do vídeo no qual será feita a detecção dos cortes.}

    \item{\textbf{Montagem do Ritmo Visual por sub-amostragem:} Para realizar a detecção das transições,
    o sistema irá gerar uma imagem 2D que representa o Ritmo Visual do
    vídeo, como definido na Seção \ref{ritmo_visual}.

    \hspace*{0.65cm}Este processo se dá de acordo com os seguintes passos:

    \begin{enumerate}
        \item{Obtenção do Frame;}
        \item{Conversão do Frame para tons de cinza;}
        \item{Cálculo da Diagonal Principal deste Frame.}
    \end{enumerate}

    \hspace*{0.65cm}Tais passos se repetem do primeiro, até o último frame do vídeo.}

    \item{\textbf{Segmentação de Imagem - Extração da área de interesse:} Para vídeos que estejam no
    formato \textit{widescreen}, será realizada a extração da área de interesse (área do vídeo), para
    que não haja interferência nos resultados por parte das bordas pertencentes ao \textit{widescreen}. }

    \item{\textbf{Detecção de Bordas - Operador Canny:} Será aplicado o operador de Canny para
    realizar a detecção das bordas. Como visto na Seção
    \ref{deteccao_de_bordas}, com a aplicação deste operador, é possível
    obter o mapa de bordas do Ritmo Visual, o qual irá mostrar a
    localização de possíveis transições de cortes no vídeo.}

    \item{\textbf{Mapa de Bordas:} Gerado com a aplicação do Operador Canny no RV, o mapa de bordas possibilitará a definição dos pontos
    onde há a ocorrência dos cortes.}

    \item{\textbf{Limiar de corte e contagem de pontos:} Gerado o mapa de bordas, será necessário determinar quais bordas
    serão consideradas transições de cortes e quais serão ignoradas pelo
    fato de pertencerem a objetos da imagem. Tal processo será realizado
    através da contagem de pontos pertencentes às retas verticais
    detectadas. Quanto maior for este número, maior a possibilidade da
    borda estar representando um corte. Para isso, define-se um limiar, o
    que possibilita realizar a classificação entre aquilo que representa
    uma borda gerada por um objeto, e daquilo que representa uma transição de
    corte.}

    \item{\textbf{Validação dos pontos encontrados:} Neste ponto o sistema
    verifica se o ponto apontado como transição de corte não se trata de um fade através da análise da média da luminância
    dos próximos frames e dos frames anteriores. Se esta for muito baixa, significa que os
    próximos frames ou os frames anteriores são pretos, ou bastante
    escuros, o que torna alta a probabilidade destes frames serem pertencentes ao início ou final de um fade.
    Além disso, é realizado o cálculo da diferença entre a média da luminância
    dos dois próximos frames e a média da luminância dos dois frames anteriores. Se esta for nula, ou muito baixa,
    há grande chance do sistema ter detectado uma borda no Ritmo Visual gerada por um objeto de cena. Caso ocorra um destes
    casos, o ponto será ignorado.}

    \item{\textbf{Transições:}
    No final deste processo, estarão identificadas as transições do vídeo
    do tipo corte.}
\end{enumerate}


\section{Fade \label{met_fade}}

\begin{figure}[h|top]
    \centering
    \includegraphics[width=1.0\linewidth]{imagens/metodologia_fades.png}
    \caption{Metodologia utilizada para a detecção de Fade.}
    \label{img_metfades} Fonte: Autor.
\end{figure}

Como visto na Seção \ref{ed_fadein}, o fade-in é uma transição de
tomadas mais escuras para tomadas mais claras, enquanto o fade-out,
visto na Seção \ref{ed_fadeout}, possui um efeito inverso, ou seja,
de tomadas mais claras para tomadas mais escuras.

Devido à similaridade entre estas duas transições, a metodologia
utilizada para a detecção de ambas será semelhante, como pode ser
visto na Figura \ref{img_metfades}. Primeiramente será mostrada a
metodologia do fade-in e posteriormente serão comentadas as
diferenças da mesma em relação ao fade-out.

\subsection{Fade-in \label{met_fadein}}

O processo para detecção de transições do tipo fade-in será:

\begin{enumerate}
    \item{\textbf{Vídeo:} É feita a entrada do vídeo no qual será feita a detecção dos fade-in.}

    \item{\textbf{Ritmo Visual por Histograma (RVH):} A partir do vídeo de entrada, cria-se uma simplificação
    do mesmo chamada Ritmo Visual por Histograma (Seção
    \ref{ritmo_visual_histograma}).

    O processo para criar um RVH possui os seguintes passos:
    \begin{enumerate}
    \item{Obtenção do Frame;}
    \item{Converte Frame para tons de cinza;}
    \item{Cálculo da Diagonal Principal deste Frame;}
    \item{Obtenção do Histograma desta diagonal.}
    \end{enumerate}
    \hspace*{0.65cm}Tais passos se repetem seqüencialmente do primeiro,
    até o último frame do vídeo.

    \hspace*{0.65cm}Um exemplo de um RVH de uma sequência de vídeo onde
    ocorre um fade-in pode ser visto na Figura \ref{img_met_fadein_rvh}.
    Onde o eixo $x$ representa os valores de luminância extraídos de
    cada diagonal do frame, e o eixo $y$ representa cada frame do vídeo.

    }

    \begin{figure}[h|top]
        \centering
        \includegraphics[width=1.0\linewidth]{imagens/metodologia_fadein_rvh.png}
        \caption{RVH de uma sequência que contém uma transição do tipo
        fade-in.} \label{img_met_fadein_rvh} Fonte: Adaptado de \cite{FERNANDO_1999}.
    \end{figure}

    \item{\textbf{Cálculo das Derivadas do RVH:} Obtido o RVH,
    calcula-se a sua derivada primeira. A partir da função derivada, é
    possível visualizar o comportamento de um fade-in. No momento em que
    a sequência estiver com seus frames mais escuros, a curva se manterá
    mais constante, ao iniciar o processo da transição (clareamento da
    tomada), ocorrerá uma forte variação na curva, a qual se manterá até
    o momento em que a luminosidade dos frames deixe de variar, fazendo
    também com que o comportamento da curva torne-se estável novamente.}

    \item{\textbf{Análise das Derivadas:} 

		Tendo as derivadas calculadas, o sistema começa a analizá-las, à fim de encontrar padrões de fade-in (Figura: \ref{img_met_fadein_rvhd})
		e fade-out (Figura: \ref{img_met_fadein_rvhd}).

		Este array de derivadas é percorrido ponto a ponto, em busca de intervalos onde a derivada começa e termina uma variação, como nas figuras citadas acima.

	  	Para o sistema começar a analizar uma variação, este precisa estar dentro das seguintes condições:

		\begin{enumerate}
		\item{ Ter uma variância na sua derivada }
		\item{ Esta variância não ser muito abrupta (Pois evidencia um CORTE)}
		\item{ O ponto anterior não ter variação alguma, ou seja, estava constante }
		\end{enumerate}

		A partir disso, o sistema começa analizar a variação encontrada.

		Para encontrar o ponto final desta variação, o sistema checa as seguintes condições:

		\begin{enumerate}
		\item{ Se no ponto não houver nenhuma variação, finaliza-se a análize}
		\end{enumerate}

		Sob posse desta variação, o sistema checa as seguintes condições:

		\begin{enumerate}
		\item{ O intervalo de variação deve conter mais do que 10 Frames, pois um valor menor que esse indica um Corte}
		\item{ O intervalo não pode ter em seu ponto final, uma variação muito abrupta, pois isso evidencia um Corte}
		\end{enumerate}

		Assim, definimos que uma variação é de fato um fade.
			Para o sistema diferenciar entre um Fade-in e um Fade-out:

		\begin{enumerate}
		\item{Fade-in  : O primeiro ponto da variação é um Frame com predominância PRETO}
		\item{Fade-out : O último ponto da variação é um Frame com predominância PRETO}
		\end{enumerate}
	 }

\end{enumerate}

\section{Dissolve \label{met_dissolve}}

\begin{figure}[h|top]
    \centering
    \includegraphics[width=1.0\linewidth]{imagens/metodologia_dissolve.png}
    \caption{Metodologia utilizada para a detecção de dissolve.}
    \label{img_metdissolve} Fonte: Adaptado de \cite{FERNANDO_1999}.
\end{figure}

\hspace*{1.25cm}A Figura \ref{img_metcortes} representa a metodologia utilizada para
a detecção de transições do tipo Dissolve:

\begin{enumerate}
    \item{\textbf{Vídeo:} É feita a entrada do vídeo no qual será feita a detecção das transições do tipo Dissolve.}

    \item{\textbf{Cálculo do RV por Histograma:} Para a realização da detecção de transições do tipo
    dissolve, o sistema irá primeiramente gerar o RVH do vídeo.}

    \hspace*{0.65cm}Este processo se dá através dos seguintes passos:

    \begin{enumerate}
        \item{Obtenção do Frame;}
        \item{Converte Frame para tons de cinza;}
        \item{Cálculo da Diagonal Principal deste Frame;}
        \item{Obtenção do Histograma desta diagonal.}
        \item{Cálculo da Variância do Histograma.}
    \end{enumerate}

    \hspace*{0.65cm}Tais passos se repetem seqüencialmente do primeiro,
    até o último frame do vídeo.

    \item{\textbf{Verifica pontos de dissolve com 7 pontos seguintes:} A partir dos pontos do Ritmo visual por historgrama, é verificado
    os próximos 7 pontos. Caso estes pontos estejam em ordem crescente ou decrescente, este ponto é um possível ponto de dissolve.}

    \item{\textbf{Derivada dos possíveis pontos de Dissolve:} Para os possíveis pontos de Dissolve, a derivada destes pontos é calculada,
     comparando os resultados obtidos a um threshold definido.}

    \item{\textbf{Detecção do Dissolve:} Caso os pontos em questão forem todos menores que o threshold,
    o primeiro ponto é o início do Dissolve.}

    \item{\textbf{Verificação de frames escuros nos pontos detectados:} Com base nas detecções, verificamos se o nível de luminância
    é proximo ao preto, caso positivo, ele será descartado pois tudo indica que é uma transição do tipo fade}

    \item{\textbf{Dissolve detectado:} No final deste processo,
    estarão identificados os pontos de ocorrência de transições do tipo Dissolve.}
    \end{enumerate}
